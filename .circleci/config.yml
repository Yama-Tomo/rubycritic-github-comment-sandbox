version: 2

jobs:
  reviewdog:
    parallelism: 1
    working_directory: ~/work
    environment:
      RAILS_ENV: test
    docker:
      - image: ruby:2.6.3
    steps:
      - checkout
      - run:
          name: reviewdog
          command: |
            curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh | sh -s
            export REVIEWDOG_GITHUB_API_TOKEN=$GITHUB_ACCESS_TOKEN
            bundle exec rubocop | ./bin/reviewdog -f=rubocop -reporter=github-pr-check
  rubycritic:
    environment:
      REPORT_PATH: /report 
      BASE_BRANCH: master
    parallelism: 1
    working_directory: ~/work
    docker:
      - image: ruby:2.6.3
    steps:
      - checkout
      - run:
          name: rubycritic
          command: .circleci/rubycritic.sh
      - store_artifacts:
          path: /report
      - run:
          name: reviewdog
          command: |
            curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh | sh -s
            export REVIEWDOG_TOKEN=$GITHUB_ACCESS_TOKEN
            bundle exec rubocop | ./bin/reviewdog -f=rubocop -reporter=github-pr-review

workflows:
  version: 2
  build:
    jobs:
      - reviewdog
